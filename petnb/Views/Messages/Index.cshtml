@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    var token = HttpContextAccessor.HttpContext.Session.GetString("FirebaseToken");
    var Conversations = ViewBag.Conversations;
    var messageIndex = 0;
}


<div class="grid-container" style="height: 77vh;">
    <div class="filter">
        @{int i = 0;}
        @foreach (var Conversation in Conversations)
        {
            <div class="person-message" ng-click="messageIndex = i">
                <div class="profile-picture-message">
                    <p>@Conversation.MessageReceiver</p>
                </div>
            </div>
            i++;
        }
    </div>
    <div class="messages-placeholder">
        @foreach (var message in Conversations[messageIndex].Messages)
        {
            @if (message.IsReceiverMessage)
            {
                <div>
                    <p class="left"><img src="https://cdn.images.express.co.uk/img/dynamic/11/590x/KKSKS-717334.jpg" class="message-picture"/>@message.MessageText</p>
                </div>
            }
            else
            {
                <div>
                    <p class="message-right">@message.MessageText<img src="https://content-static.upwork.com/uploads/2014/10/01073427/profilephoto1.jpg" class="message-picture" /></p>
                </div>
            }
        }

        <div class="message-input-placeholder">
            <input class="message-input-field-text" type="text"/>
            <button id="sendMsg" type="submit" class="message-send-btn">
                <svg class="svgIcon" height="28px" width="26px" version="1.1" viewBox="0 0 16 16" x="0px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" y="0px">
                <path d="M11,8.3L2.6,8.8C2.4,8.8,2.3,8.9,2.3,9l-1.2,4.1c-0.2,0.5,0,1.1,0.4,1.5C1.7,14.9,2,15,2.4,15c0.2,0,0.4,0,0.6-0.1l11.2-5.6 C14.8,9,15.1,8.4,15,7.8c-0.1-0.4-0.4-0.8-0.8-1L3,1.1C2.5,0.9,1.9,1,1.5,1.3C1,1.7,0.9,2.3,1.1,2.9L2.3,7c0,0.1,0.2,0.2,0.3,0.2 L11,7.7c0,0,0.3,0,0.3,0.3S11,8.3,11,8.3z" fill="#65C2AD">
                </path>
                </svg>
            </button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>

<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCoKatVz8xlteNJGwY5hg_tDWEQ36foOGI",
        authDomain: "frontend-69cae.firebaseapp.com",
        databaseURL: "https://frontend-69cae.firebaseio.com",
        projectId: "frontend-69cae",
        storageBucket: "frontend-69cae.appspot.com",
        messagingSenderId: "574904259542"
    };
    firebase.initializeApp(config);

    var token = "@Html.Raw(token)";
    console.log(token)

    var user = firebase.auth().currentUser;
    if (user == null) {

    firebase.auth().signInWithCustomToken(token).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(errorMessage);
        console.log("succ");
        // ...
    }).then(function() {
    console.log(firebase.auth().currentUser);

            });

    }



    var user = firebase.auth().currentUser;

</script>